(function(f){if(!Array.isArray){Array.isArray=function(m){return Object.prototype.toString.call(m)=="[object Array]"}}if(!Array.prototype.filter){Array.prototype.filter=function(n){var m=this.length;if(typeof n!="function"){throw new TypeError()}var q=new Array();var p=arguments[1];for(var o=0;o<m;o++){if(o in this){var r=this[o];if(n.call(p,r,o,this)){q.push(r)}}}return q}}var h=document.location;function j(){return h.hash===""||h.hash==="#"}var d={mode:"modern",hash:h.hash,history:false,check:function(){var m=h.hash;if(m!=this.hash){this.hash=m;this.onHashChanged()}},fire:function(){if(this.mode==="modern"){this.history===true?window.onpopstate():window.onhashchange()}else{this.onHashChanged()}},init:function(o,p){var m=this;this.history=p;if(!c.listeners){c.listeners=[]}function n(u){for(var t=0,r=c.listeners.length;t<r;t++){c.listeners[t](u)}}if("onhashchange" in window&&(document.documentMode===undefined||document.documentMode>7)){if(this.history===true){setTimeout(function(){window.onpopstate=n},500)}else{window.onhashchange=n}this.mode="modern"}else{var q=document.createElement("iframe");q.id="state-frame";q.style.display="none";document.body.appendChild(q);this.writeFrame("");if("onpropertychange" in document&&"attachEvent" in document){document.attachEvent("onpropertychange",function(){if(event.propertyName==="location"){m.check()}})}window.setInterval(function(){m.check()},50);this.onHashChanged=n;this.mode="legacy"}c.listeners.push(o);return this.mode},destroy:function(o){if(!c||!c.listeners){return}var n=c.listeners;for(var m=n.length-1;m>=0;m--){if(n[m]===o){n.splice(m,1)}}},setHash:function(m){if(this.mode==="legacy"){this.writeFrame(m)}if(this.history===true){window.history.pushState({},document.title,m);this.fire()}else{h.hash=(m[0]==="/")?m:"/"+m}return this},writeFrame:function(m){var n=document.getElementById("state-frame");var o=n.contentDocument||n.contentWindow.document;o.open();o.write("<script>_hash = '"+m+"'; onload = parent.listener.syncHash;<script>");o.close()},syncHash:function(){var m=this._hash;if(m!=h.hash){h.hash=m}return this},onHashChanged:function(){}};var c=f.Router=function(m){if(!(this instanceof c)){return new c(m)}this.params={};this.routes={};this.methods=["on","once","after","before"];this.scope=[];this._methods={};this._insert=this.insert;this.insert=this.insertEx;this.historySupport=(window.history!=null?window.history.pushState:null)!=null;this.configure();this.mount(m||{})};c.prototype.init=function(n){var m=this,o;this.handler=function(r){var q=r&&r.newURL||window.location.hash;var p=m.history===true?m.getPath():q.replace(/.*#/,"");m.dispatch("on",p.charAt(0)==="/"?p:"/"+p)};d.init(this.handler,this.history);if(this.history===false){if(j()&&n){h.hash=n}else{if(!j()){m.dispatch("on","/"+h.hash.replace(/^(#\/|#|\/)/,""))}}}else{if(this.convert_hash_in_init){o=j()&&n?n:!j()?h.hash.replace(/^#/,""):null;if(o){window.history.replaceState({},document.title,o)}}else{o=this.getPath()}if(o||this.run_in_init===true){this.handler()}}return this};c.prototype.explode=function(){var m=this.history===true?this.getPath():h.hash;if(m.charAt(1)==="/"){m=m.slice(1)}return m.slice(1,m.length).split("/")};c.prototype.setRoute=function(o,m,p){var n=this.explode();if(typeof o==="number"&&typeof m==="string"){n[o]=m}else{if(typeof p==="string"){n.splice(o,m,s)}else{n=[o]}}d.setHash(n.join("/"));return n};c.prototype.insertEx=function(p,o,m,n){if(p==="once"){p="on";m=function(q){var r=false;return function(){if(r){return}r=true;return q.apply(this,arguments)}}(m)}return this._insert(p,o,m,n)};c.prototype.getRoute=function(m){var n=m;if(typeof m==="number"){n=this.explode()[m]}else{if(typeof m==="string"){var o=this.explode();n=o.indexOf(m)}else{n=this.explode()}}return n};c.prototype.destroy=function(){d.destroy(this.handler);return this};c.prototype.getPath=function(){var m=window.location.pathname;if(m.substr(0,1)!=="/"){m="/"+m}return m};function i(m,o){for(var n=0;n<m.length;n+=1){if(o(m[n],n,m)===false){return}}}function l(m){var q=[];for(var o=0,p=m.length;o<p;o++){q=q.concat(m[o])}return q}function k(m,p,q){if(!m.length){return q()}var o=0;(function n(){p(m[o],function(r){if(r||r===false){q(r);q=function(){}}else{o+=1;if(o===m.length){q()}else{n()}}})})()}function g(p,o,m){m=p;for(var n in o){if(o.hasOwnProperty(n)){m=o[n](p);if(m!==p){break}}}return m===p?"([._a-zA-Z0-9-%()]+)":m}function e(t,o){var r,u=0,p="";while(r=t.substr(u).match(/[^\w\d\- %@&]*\*[^\w\d\- %@&]*/)){u=r.index+r[0].length;r[0]=r[0].replace(/^\*/,"([_.()!\\ %@&a-zA-Z0-9-]+)");p+=t.substr(0,r.index)+r[0]}t=p+=t.substr(u);var m=t.match(/:([^\/]+)/ig),v,n;if(m){n=m.length;for(var q=0;q<n;q++){v=m[q];if(v.slice(0,2)==="::"){t=v.slice(1)}else{t=t.replace(v,g(v,o))}}}return t}function a(w,m,n,r){var u=0,o=0,v=0,n=(n||"(").toString(),r=(r||")").toString(),q;for(q=0;q<w.length;q++){var t=w[q];if(t.indexOf(n,u)>t.indexOf(r,u)||~t.indexOf(n,u)&&!~t.indexOf(r,u)||!~t.indexOf(n,u)&&~t.indexOf(r,u)){o=t.indexOf(n,u);v=t.indexOf(r,u);if(~o&&!~v||!~o&&~v){var p=w.slice(0,(q||1)+1).join(m);w=[p].concat(w.slice((q||1)+1))}u=(v>o?v:o)+1;q=0}else{u=0}}return w}var b=/\?.*/;c.prototype.configure=function(m){m=m||{};for(var n=0;n<this.methods.length;n++){this._methods[this.methods[n]]=true}this.recurse=m.recurse||this.recurse||false;this.async=m.async||false;this.delimiter=m.delimiter||"/";this.strict=typeof m.strict==="undefined"?true:m.strict;this.notfound=m.notfound;this.resource=m.resource;this.history=m.html5history&&this.historySupport||false;this.run_in_init=this.history===true&&m.run_handler_in_init!==false;this.convert_hash_in_init=this.history===true&&m.convert_hash_in_init!==false;this.every={after:m.after||null,before:m.before||null,on:m.on||null};return this};c.prototype.param=function(m,o){if(m[0]!==":"){m=":"+m}var n=new RegExp(m,"g");this.params[m]=function(p){return p.replace(n,o.source||o)};return this};c.prototype.on=c.prototype.route=function(p,o,n){var m=this;if(!n&&typeof o=="function"){n=o;o=p;p="on"}if(Array.isArray(o)){return o.forEach(function(q){m.on(p,q,n)})}if(o.source){o=o.source.replace(/\\\//ig,"/")}if(Array.isArray(p)){return p.forEach(function(q){m.on(q.toLowerCase(),o,n)})}o=o.split(new RegExp(this.delimiter));o=a(o,this.delimiter);this.insert(p,this.scope.concat(o),n)};c.prototype.path=function(o,p){var m=this,n=this.scope.length;if(o.source){o=o.source.replace(/\\\//ig,"/")}o=o.split(new RegExp(this.delimiter));o=a(o,this.delimiter);this.scope=this.scope.concat(o);p.call(this,this);this.scope.splice(n,o.length)};c.prototype.dispatch=function(u,q,t){var n=this,o=this.traverse(u,q.replace(b,""),this.routes,""),p=this._invoked,r;$.asyncall({url:$ctx+"/logPage/logPage/save.do",data:{pageUrl:q,type:"",value:"",remarks:""},success:function(v){}});this._invoked=true;if(!o||o.length===0){this.last=[];if(typeof this.notfound==="function"){this.invoke([this.notfound],{method:u,path:q},t)}$.alert("您没有该功能的操作权限，请联系系统管理员!",3);return false}if(this.recurse==="forward"){o=o.reverse()}function m(){n.last=o.after;n.invoke(n.runlist(o),n,t)}r=this.every&&this.every.after?[this.every.after].concat(this.last):[this.last];if(r&&r.length>0&&p){if(this.async){this.invoke(r,this,m)}else{this.invoke(r,this);m()}return true}m();return true};c.prototype.invoke=function(p,m,q){var o=this;var n;if(this.async){n=function(t,r){if(Array.isArray(t)){return k(t,n,r)}else{if(typeof t=="function"){t.apply(m,(p.captures||[]).concat(r))}}};k(p,n,function(){if(q){q.apply(m,arguments)}})}else{n=function(r){if(Array.isArray(r)){return i(r,n)}else{if(typeof r==="function"){return r.apply(m,p.captures||[])}else{if(typeof r==="string"&&o.resource){o.resource[r].apply(m,p.captures||[])}}}};i(p,n)}};c.prototype.traverse=function(n,A,x,w,o){var y=[],v,t,q,p,u;function z(r){if(!o){return r}function D(G){var E=[];for(var F=0;F<G.length;F++){E[F]=Array.isArray(G[F])?D(G[F]):G[F]}return E}function C(F){for(var E=F.length-1;E>=0;E--){if(Array.isArray(F[E])){C(F[E]);if(F[E].length===0){F.splice(E,1)}}else{if(!o(F[E])){F.splice(E,1)}}}}var B=D(r);B.matched=r.matched;B.captures=r.captures;B.after=r.after.filter(o);C(B);return B}if(A===this.delimiter&&x[n]){p=[[x.before,x[n]].filter(Boolean)];p.after=[x.after].filter(Boolean);p.matched=true;p.captures=[];return z(p)}for(var m in x){if(x.hasOwnProperty(m)&&(!this._methods[m]||this._methods[m]&&typeof x[m]==="object"&&!Array.isArray(x[m]))){v=t=w+this.delimiter+m;if(!this.strict){t+="["+this.delimiter+"]?"}q=A.match(new RegExp("^"+t));if(!q){continue}if(q[0]&&q[0]==A&&x[m][n]){p=[[x[m].before,x[m][n]].filter(Boolean)];p.after=[x[m].after].filter(Boolean);p.matched=true;p.captures=q.slice(1);if(this.recurse&&x===this.routes){p.push([x.before,x.on].filter(Boolean));p.after=p.after.concat([x.after].filter(Boolean))}return z(p)}p=this.traverse(n,A,x[m],v);if(p.matched){if(p.length>0){y=y.concat(p)}if(this.recurse){y.push([x[m].before,x[m].on].filter(Boolean));p.after=p.after.concat([x[m].after].filter(Boolean));if(x===this.routes){y.push([x.before,x.on].filter(Boolean));p.after=p.after.concat([x.after].filter(Boolean))}}y.matched=true;y.captures=p.captures;y.after=p.after;return z(y)}}}return false};c.prototype.insert=function(m,v,t,r){var o,u,p,q,n;v=v.filter(function(w){return w&&w.length>0});r=r||this.routes;n=v.shift();if(/\:|\*/.test(n)&&!/\\d|\\w/.test(n)){n=e(n,this.params)}if(v.length>0){r[n]=r[n]||{};return this.insert(m,v,t,r[n])}if(!n&&!v.length&&r===this.routes){o=typeof r[m];switch(o){case"function":r[m]=[r[m],t];return;case"object":r[m].push(t);return;case"undefined":r[m]=t;return}return}u=typeof r[n];p=Array.isArray(r[n]);if(r[n]&&!p&&u=="object"){o=typeof r[n][m];switch(o){case"function":r[n][m]=[r[n][m],t];return;case"object":r[n][m].push(t);return;case"undefined":r[n][m]=t;return}}else{if(u=="undefined"){q={};q[m]=t;r[n]=q;return}}throw new Error("Invalid route context: "+u)};c.prototype.extend=function(o){var n=this,m=o.length,p;function q(r){n._methods[r]=true;n[r]=function(){var t=arguments.length===1?[r,""]:[r];n.on.apply(n,t.concat(Array.prototype.slice.call(arguments)))}}for(p=0;p<m;p++){q(o[p])}};c.prototype.runlist=function(m){var n=this.every&&this.every.before?[this.every.before].concat(l(m)):l(m);if(this.every&&this.every.on){n.push(this.every.on)}n.captures=m.captures;n.source=m.source;return n};c.prototype.mount=function(m,q){if(!m||typeof m!=="object"||Array.isArray(m)){return}var o=this;q=q||[];if(!Array.isArray(q)){q=q.split(o.delimiter)}function p(u,w){var t=u,y=u.split(o.delimiter),r=typeof m[u],v=y[0]===""||!o._methods[y[0]],x=v?"on":t;if(v){t=t.slice((t.match(new RegExp("^"+o.delimiter))||[""])[0].length);y.shift()}if(v&&r==="object"&&!Array.isArray(m[u])){w=w.concat(y);o.mount(m[u],w);return}if(v){w=w.concat(t.split(o.delimiter));w=a(w,o.delimiter)}o.insert(x,w,m[u])}for(var n in m){if(m.hasOwnProperty(n)){p(n,q.slice(0))}}}}(typeof exports==="object"?exports:window));